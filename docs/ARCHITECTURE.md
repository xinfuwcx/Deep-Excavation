# 深基坑CAE系统架构文档

## 系统概述

深基坑CAE系统是一个专业的深基坑工程建模、计算和分析软件，集成了几何建模、等几何分析和结果可视化等功能。系统采用现代化的技术栈，包括Python后端、React前端，以及Kratos等几何分析引擎。

## 系统架构

### 1. 整体架构

系统采用前后端分离的架构：

```
+----------------+      +----------------+      +----------------+
|                |      |                |      |                |
|  前端 (React)   +----->+  后端 (FastAPI) +----->+  计算引擎      |
|                |      |                |      |                |
+----------------+      +----------------+      +----------------+
                                |
                                v
                        +----------------+
                        |                |
                        |  数据库         |
                        |  (SQLAlchemy)  |
                        |                |
                        +----------------+
```

### 2. 核心模块

#### 2.1 几何建模模块

- **OCCWrapper**: 封装OpenCascade几何建模功能
- 支持基本几何体创建和NURBS曲面定义
- 与前端几何编辑器集成

#### 2.2 计算分析模块

- **KratosIgaSolver**: 基于Kratos的等几何分析(IGA)求解器
- 支持结构力学分析
- 可扩展支持流体分析(待实现)

#### 2.3 可视化模块

- **TrameVisServer**: 基于Trame的可视化服务器
- 支持三维模型和计算结果可视化
- 与前端Three.js集成

### 3. 数据流

```
+-------------+     +-------------+     +------------+
| 几何建模数据 | --> | 计算分析数据 | --> | 可视化结果  |
+-------------+     +-------------+     +------------+
      |                  |                  |
      v                  v                  v
+------------------------------------------------------------------+
|                           数据库存储                              |
+------------------------------------------------------------------+
```

## 技术栈

### 1. 后端技术

- **语言**: Python 3.9+
- **Web框架**: FastAPI
- **ORM**: SQLAlchemy
- **计算引擎**: 
  - Kratos Multiphysics (IGA应用)
- **可视化**: Trame/VTK

### 2. 前端技术

- **框架**: React 18
- **UI库**: Material-UI
- **3D可视化**: Three.js
- **状态管理**: Zustand
- **构建工具**: Vite

## 更新的技术路线

### 1. 专注IGA

系统专注于IGA（等几何分析）技术，不采用传统有限元方法：
- **直接NURBS分析**: 几何模型直接用于分析，无需网格生成
- **高精度**: 采用高阶NURBS基函数，获得更高计算精度
- **简化工作流**: 省略网格生成步骤，简化设计到分析的流程

### 2. 数据流优化

- 简化从前端到后端的数据流程
- 建立NURBS几何到IGA分析的直接转换
- 统一数据格式和接口规范

### 3. 系统集成

- **精简依赖**: 移除非IGA必需的组件（如Gmsh）
- **前后端通信**: 采用RESTful API，端口配置为前端1000，后端6000
- **数据库模型**: 优化SQLAlchemy模型设计，避免使用保留字

### 4. 扩展功能路线图

- **流体分析**: 计划集成Kratos流体动力学IGA模块
- **接触分析**: 开发IGA框架下的接触算法
- **高级可视化**: 增强结果展示能力

## 部署架构

```
+-------------------+     +-------------------+
|                   |     |                   |
|  开发环境          |     |  生产环境          |
|  (Docker开发容器)  |     |  (Docker部署)     |
|                   |     |                   |
+-------------------+     +-------------------+
        |                          |
        v                          v
+-------------------------------------------+
|                                           |
|            代码版本控制 (Git)              |
|                                           |
+-------------------------------------------+
```

## 系统启动流程

1. 启动后端API服务器 (`python -m src.server.app`)
2. 启动前端开发服务器 (`cd frontend && npm run dev`)
3. 访问前端应用 (http://localhost:1000) 